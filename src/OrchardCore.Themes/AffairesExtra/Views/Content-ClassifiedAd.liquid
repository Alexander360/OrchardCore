{% script src:"https://www.google.com/recaptcha/api.js" %}

<section>
    {% if Request.Query.sent != null %}
    <div class="alert alert-success" role="alert">
    Votre message a été envoyé ; nous vous répondrons d'ici peu. <strong>Merci !</strong>
    </div>
    {% endif %}
    {% if Request.Query.error != null %}
    <div class="alert alert-warning" role="alert">
    Veuillez cliquer sur le Recaptcha. <strong>Merci !</strong>
    </div>
    {% endif %}
  <div class="container">
	<div class="row">
		<div class="col-md-6">
			<h1>{{ Model.ContentItem.DisplayText }}<span class="brand-model">{{ machinery_brand | display_text }} {{ Model.ContentItem.Content.ClassifiedAd.Model.Text }}</span></h1>
			<div class="price">
                {%if Model.ContentItem.Content.ClassifiedAd.Price.Value != null %}
                    {{ Model.ContentItem.Content.ClassifiedAd.Price.Value }} $ CAD
                {% else %}
                    {{ "Price upon request" | t }}
                {% endif %}
            </div>
			
			<table class="table border-bottom product-table">


				{%if Model.ContentItem.Content.ClassifiedAd.Town.Text != null and Model.ContentItem.Content.ClassifiedAd.Town.Text != "0" %}
				<tr>
					<td>{{ "Town" | t }} : </td>
					<td class="text-right">{{ Model.ContentItem.Content.ClassifiedAd.Town.Text }}</td>
				</tr>
				{% endif %}

				{%if Model.ContentItem.Content.ClassifiedAd.PostalCode.Text != null and Model.ContentItem.Content.ClassifiedAd.PostalCode.Text != "0" %}
				<tr>
					<td>{{ "Zip Code" | t }} : </td>
					<td class="text-right">{{ Model.ContentItem.Content.ClassifiedAd.PostalCode.Text }}</td>
				</tr>
				{% endif %}

                {%if Model.ContentItem.Content.ClassifiedAd.Company.Text != null and Model.ContentItem.Content.ClassifiedAd.Company.Text != "0" %}
				<tr>
					<td>{{ "Advertiser" | t }} : </td>
					<td class="text-right">{{ Model.ContentItem.Content.ClassifiedAd.Company.Text }}</td>
				</tr>
                {% endif %}

				{%if Model.ContentItem.Content.ClassifiedAd.ContactPerson.Text != null and Model.ContentItem.Content.ClassifiedAd.ContactPerson.Text != "0" %}
				<tr>
					<td>{{ "Contact Person" | t }} : </td>
					<td class="text-right">{{ Model.ContentItem.Content.ClassifiedAd.ContactPerson.Text }}</td>
				</tr>
				{% endif %}

				{%if Model.ContentItem.Content.ClassifiedAd.Description.Text != null %}
				<tr>
					<td colspan="2">{{ "Additional informations" | t }} :  <br/><br/>{{ Model.ContentItem.Content.ClassifiedAd.Description.Text }}</td>
				</tr>
				{% endif %}
			</table>
			
		</div>
		<div class="col-sm-6">
			<div class="row">
				<div class="col">
                    {% if Model.ContentItem.Content.ClassifiedAd.WebsitePictures.Paths.size > 0 %}
                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                      <ol class="carousel-indicators">
                        {% for i in (1..Model.ContentItem.Content.ClassifiedAd.WebsitePictures.Paths.size) %}
                            {% if i == 1 %}
                                <li data-target="#carouselExampleIndicators" data-slide-to="{{i}}" class="active"></li>
                            {% else %}
                                <li data-target="#carouselExampleIndicators" data-slide-to="{{i}}"></li>
                            {% endif %}
                        {% endfor %}
                      </ol>
                      <div class="carousel-inner">
                        {% for i in (1..Model.ContentItem.Content.ClassifiedAd.WebsitePictures.Paths.size) %}
                            {% if i == 1 %}
                                <div class="carousel-item active">
                                  <img class="card-img-top" src="{{ Model.ContentItem.Content.ClassifiedAd.WebsitePictures.Paths[i - 1] | asset_url }}" alt="{{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ item.Content.ClassifiedAd.Model.Text }}" />
                                </div>
                            {% else %}
                                <div class="carousel-item">
                                  <img class="card-img-top" src="{{ Model.ContentItem.Content.ClassifiedAd.WebsitePictures.Paths[i - 1] | asset_url }}" alt="{{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ item.Content.ClassifiedAd.Model.Text }}" />
                                </div>
                            {% endif %}
                        {% endfor %}
                      </div>
                      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                  </div>
                  {% else %}
                  {{Model.ContentItem.Content.ClassifiedAd.WebsitePictures.Paths.Count}}
                  <img class="card-img-top" src="/AffairesExtra/img/noimage.png" alt="{{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ item.Content.ClassifiedAd.Model.Text }}" />
                  {% endif %}
               </div>
            </div>
			<div class="row">
				<div class="col">
					<div class="mt-3 mb-2"><strong>PARTAGER</strong></div>
					<a href="javascript: void()"><i class="fab fa-facebook-square fa-w-14 fa-3x"></i></a>
					<a href="mailto:?subject={{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ Model.ContentItem.Content.ClassifiedAd.Model.Text }}&amp;body={{ Request.Scheme }}://{{ Request.Host }}{{ Request.Path }}"><i class="fas fa-envelope-square fa-w-14 fa-3x"></i></a>
				</div>
			</div>
            <div class="row">
		        <div class="col">
			        <h2 class="mb-4 mt-4">{{ "Information request" | t }}</h2>
			        <form method="post" action="/workflows/Invoke?token=CfDJ8LetxqJ1HAVDuMzNanVXaTTGrqXq9r_2gVgW6p5ubcoMmQCBrC7vnXLaWBxzjpO7PvHK-RJqCH5QbDoGDedTeqSmJC9rVCyd6gbMHcUEoXe7unGBC5emvWQR5FC5FkIDOOCQLITpsF60xgePZ-YiYNZOIlAFfWBiLT8UX6w5ne-Hd_bgzhLOcAtoP-ZEyxrvR4FWbq5lSL-yUmXGboWslVxW-T2p4yNxYzzZ4jHkscTm">
			          {% antiforgerytoken %}
                      <input type="hidden" name="ProductId" value="{{ Model.ContentItem.ContentItemId }}" />
                      <input type="hidden" name="ReturnUrl" value="{{ Request.Path }}" />
                      <div class="form-group">
				        <input name="FullName" type="text" class="form-control" id="FullName" placeholder="Nom du contact">
			          </div>
			          <div class="form-group">
				        <input name="Email" type="email" class="form-control" id="Email" aria-describedby="emailHelp" placeholder="Entrez votre courriel">
				        <small id="emailHelp" class="form-text text-muted">{{ "We'll never share your email with anyone else." | t }}</small>
			          </div>
			          <div class="form-group">
				        <input name="Phone" type="text" class="form-control" id="Phone" placeholder="{{ "Phone" | t }}">
			          </div>
			          <div class="form-group">
				        <input name="Town" type="text" class="form-control" id="Town" placeholder="{{ "Town" | t }}">
			          </div>
			          <div class="form-group">
				        <textarea name="Message" class="form-control" id="Message" placeholder="Message"></textarea>
			          </div>
                      <div class="g-recaptcha mb-3" data-sitekey="6LcEqWkUAAAAAL9FPZNjtLZJDcqU1l9OWVReEnBy"></div>
			          <button type="submit" class="btn btn-primary">{{ "Send" | t }}</button>
			        </form>
		        </div>
	        </div>
		</div>
	</div>
	<hr class="mt-4" />

  </div>

  {% assign relatedClassifiedAd = Queries.RelatedClassifiedAd |  query: from: 0, size: 3, condition: "*", type: machinery_type.ContentItemId, brand: machinery_brand.ContentItemId, current: Model.ContentItem.ContentItemId %}
  {% assign count = relatedClassifiedAd | size %}
  {% if count > 0 %}
  <hr class="mt-4" />
  
  
  <h2 class="text-center mt-4 mb-4">Annonces similaires</h2>
  <div class="row">  
  
  {% for item in relatedClassifiedAd %}
          <div class="col-md-4 d-flex align-items-stretch">

            {% assign machinery_type = Content.ContentItemId[item.Content.ClassifiedAd.Type.ContentItemIds[0]] %}
            {% assign machinery_brand = Content.ContentItemId[item.Content.ClassifiedAd.Brand.ContentItemIds[0]] %}
            {% assign machinery_advertiser = Content.ContentItemId[item.Content.ClassifiedAd.Advertiser.ContentItemIds[0]] %}
            {% assign machinery_region = Content.ContentItemId[item.Content.ClassifiedAd.Region.ContentItemIds[0]] %}
            {% assign img_alt =  machinery_type | append: ' ' | machinery_brand | append: ' ' | append: item.Content.ClassifiedAd.Model.Text %}
            <div class="card mb-3">
                <a href="{{ item | display_url }}">
                    {% if item.Content.ClassifiedAd.WebsitePictures.Paths.size > 0 %}
                        {{ item.Content.ClassifiedAd.WebsitePictures.Paths[0] | asset_url | resize_url: 480 | img_tag: alt: img_alt, class:'card-img-top' }}
                    {% else %}
                        <img class="card-img-top" alt="no image" src="/AffairesExtra/img/noimage.png">
                    {% endif %}
                </a>
              <div class="card-body">
                {% if item.Content.ClassifiedAd.Price.Value > 0 %}
                  <h5 class="card-text">{{ item.Content.ClassifiedAd.Price.Value }} $ CAD</h5>
                {% else %}
                  <h5 class="card-text">{{ "Price upon request" | t }}</h5>
                {% endif %}    
                <h5 class="card-title"><a href="{{ item | display_url }}">{{ machinery_type | display_text }} <br/> {{ machinery_brand | display_text }} {{ item.Content.ClassifiedAd.Model.Text }}</a></h5> 
                {% if item.Content.ClassifiedAd.Year.Value != null and item.Content.ClassifiedAd.Year.Value > 0 %}
                <p class="card-text">Année: {{ item.Content.ClassifiedAd.Year.Value }}</p>
                {% endif %}
                {% if machinery_advertiser %}
                <p class="card-text">Concessionnaire: {{ machinery_advertiser | display_text }}</p>
                {% endif %}
                {% if machinery_region %}
                <p class="card-text">Région: {{ machinery_region }}</p>
                {% endif %}

              </div>
              <div class="card-footer text-center"><a href="{{ item | display_url }}" class="btn btn-primary align-self-center">Voir la fiche</a></div>
            </div>
          </div>
  {% endfor %}
  </div>
  {% endif %}
</section>