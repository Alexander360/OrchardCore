{% script src:"https://www.google.com/recaptcha/api.js" %}
{% assign machinery_type = Content.ContentItemId[Model.ContentItem.Content.Service.Type.ContentItemIds[0]] %}
{% assign machinery_brand = Content.ContentItemId[Model.ContentItem.Content.Service.Brand.ContentItemIds[0]] %}
{% assign machinery_advertiser = Content.ContentItemId[Model.ContentItem.Content.Service.Advertiser.ContentItemIds[0]] %}

<section>
    {% if Request.Query.sent != null %}
    <div class="alert alert-success" role="alert">
    Votre message a été envoyé ; nous vous répondrons d'ici peu. <strong>Merci !</strong>
    </div>
    {% endif %}
    {% if Request.Query.error != null %}
    <div class="alert alert-warning" role="alert">
    Veuillez cliquer sur le Recaptcha. <strong>Merci !</strong>
    </div>
    {% endif %}
  <div class="container">
	<div class="row">
		<div class="col-md-6">
			<h1>{{ machinery_type | display_text }}<span class="brand-model">{{ machinery_brand | display_text }} {{ Model.ContentItem.Content.Service.Model.Text }}</span></h1>
			<div class="price">
                {%if Model.ContentItem.Content.Service.Price.Value != null %}
                    {{ Model.ContentItem.Content.Service.Price.Value }} $ CAD
                {% else %}
                    {{ "Price upon request" | t }}
                {% endif %}
            </div>
			
			<table class="table border-bottom product-table">


				{%if Model.ContentItem.Content.Service.Category.Text != null and Model.ContentItem.Content.Service.Category.Text != "0" %}
				<tr>
					<td>{{ "Category" | t }} : </td>
					<td class="text-right">{{ Model.ContentItem.Content.Service.Category.Text }}</td>
				</tr>
				{% endif %}

				{%if Model.ContentItem.Content.Service.SubCategory.Text != null and Model.ContentItem.Content.Service.SubCategory.Text != "0" %}
				<tr>
					<td>{{ "Subcategory" | t }} : </td>
					<td class="text-right">{{ Model.ContentItem.Content.Service.SubCategory.Text }}</td>
				</tr>
				{% endif %}


                {%if machinery_advertiser != null %}
				<tr>
					<td>{{ "Company" | t }} : </td>
					<td class="text-right">{{ machinery_advertiser | display_text }}</td>
				</tr>
                {% endif %}
				{%if Model.ContentItem.Content.Service.AdditionalDescription.Text != null %}
				<tr>
					<td colspan="2">{{ "Additional informations" | t }} :  <br/><br/>{{ Model.ContentItem.Content.Service.AdditionalDescription.Text }}</td>
				</tr>
				{% endif %}
			</table>
            {%if machinery_advertiser != null %}
			<a class="btn btn-primary mt-2" href="{{ machinery_advertiser | display_url }}">Contactez l'annonceur</a>
            {% endif %}
		</div>
		<div class="col-sm-6">
			<div class="row">
				<div class="col">
                    {% if Model.ContentItem.Content.Service.WebsitePictures.Paths.size > 0 %}
                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                      <ol class="carousel-indicators">
                        {% for i in (1..Model.ContentItem.Content.Service.WebsitePictures.Paths.size) %}
                            {% if i == 1 %}
                                <li data-target="#carouselExampleIndicators" data-slide-to="{{i}}" class="active"></li>
                            {% else %}
                                <li data-target="#carouselExampleIndicators" data-slide-to="{{i}}"></li>
                            {% endif %}
                        {% endfor %}
                      </ol>
                      <div class="carousel-inner">
                        {% for i in (1..Model.ContentItem.Content.Service.WebsitePictures.Paths.size) %}
                            {% if i == 1 %}
                                <div class="carousel-item active">
                                  <img class="card-img-top" src="{{ Model.ContentItem.Content.Service.WebsitePictures.Paths[i - 1] | asset_url }}" alt="{{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ item.Content.Service.Model.Text }}" />
                                </div>
                            {% else %}
                                <div class="carousel-item">
                                  <img class="card-img-top" src="{{ Model.ContentItem.Content.Service.WebsitePictures.Paths[i - 1] | asset_url }}" alt="{{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ item.Content.Service.Model.Text }}" />
                                </div>
                            {% endif %}
                        {% endfor %}
                      </div>
                      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                      </a>
                  </div>
                  {% else %}
                  {{Model.ContentItem.Content.Service.WebsitePictures.Paths.Count}}
                  <img class="card-img-top" src="/AffairesExtra/img/noimage.png" alt="{{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ item.Content.Service.Model.Text }}" />
                  {% endif %}
               </div>
            </div>
			<div class="row">
				<div class="col">
					<div class="mt-3 mb-2"><strong>PARTAGER</strong></div>
					<a href="javascript: void()"><i class="fab fa-facebook-square fa-w-14 fa-3x"></i></a>
					<a href="mailto:?subject={{ machinery_type | display_text }} {{ machinery_brand | display_text }} {{ Model.ContentItem.Content.Service.Model.Text }}&amp;body={{ Request.Scheme }}://{{ Request.Host }}{{ Request.Path }}"><i class="fas fa-envelope-square fa-w-14 fa-3x"></i></a>
				</div>
			</div>
            <div class="row">
		        <div class="col">
			        <h2 class="mb-4 mt-4">{{ "Information request" | t }}</h2>
			        <form method="post" action="/workflows/Invoke?token=CfDJ8LetxqJ1HAVDuMzNanVXaTTGrqXq9r_2gVgW6p5ubcoMmQCBrC7vnXLaWBxzjpO7PvHK-RJqCH5QbDoGDedTeqSmJC9rVCyd6gbMHcUEoXe7unGBC5emvWQR5FC5FkIDOOCQLITpsF60xgePZ-YiYNZOIlAFfWBiLT8UX6w5ne-Hd_bgzhLOcAtoP-ZEyxrvR4FWbq5lSL-yUmXGboWslVxW-T2p4yNxYzzZ4jHkscTm">
			          {% antiforgerytoken %}
                      <input type="hidden" name="ProductId" value="{{ Model.ContentItem.ContentItemId }}" />
                      <input type="hidden" name="ReturnUrl" value="{{ Request.Path }}" />
                      <div class="form-group">
				        <input name="FullName" type="text" class="form-control" id="FullName" placeholder="Nom du contact">
			          </div>
			          <div class="form-group">
				        <input name="Email" type="email" class="form-control" id="Email" aria-describedby="emailHelp" placeholder="Entrez votre courriel">
				        <small id="emailHelp" class="form-text text-muted">{{ "We'll never share your email with anyone else." | t }}</small>
			          </div>
			          <div class="form-group">
				        <input name="Phone" type="text" class="form-control" id="Phone" placeholder="{{ "Phone" | t }}">
			          </div>
			          <div class="form-group">
				        <input name="Town" type="text" class="form-control" id="Town" placeholder="{{ "Town" | t }}">
			          </div>
			          <div class="form-group">
				        <textarea name="Message" class="form-control" id="Message" placeholder="Message"></textarea>
			          </div>
                      <div class="g-recaptcha mb-3" data-sitekey="6LcEqWkUAAAAAL9FPZNjtLZJDcqU1l9OWVReEnBy"></div>
			          <button type="submit" class="btn btn-primary">{{ "Send" | t }}</button>
			        </form>
		        </div>
	        </div>
		</div>
	</div>
	<hr class="mt-4" />
    {%if machinery_advertiser != null %}
	<div class="row">
		<div class="col-md-6">
				{% assign main_address = machinery_advertiser.Content.Address.ContentItems.first %}
				{%if main_address != null %}
				<div>
					<div class="row mb-3">
							<div class="col">
							    <h2>{{ machinery_advertiser }}</h2>
								<p><a href="http://{{ machinery_advertiser.Content.Address.ContentItems[0].Address.Website.Text }}" target="_blank">{{ machinery_advertiser.Content.Address.ContentItems[0].Address.Website.Text }}</a></p>
								<p>
									<strong>{{ main_address.Address.Town.Text }}</strong><br/>
									{{ main_address.Address.Street.Text }}<br/>
									{{ main_address.Address.Town.Text }}
									{{ main_address.Address.ProvinceState.Text }}
									{{ main_address.Address.PostalCode.Text }}<br/>
									<a href="https://www.google.com/maps/dir/{{ main_address.Address.PostalCode.Text }}/{{ main_address.Address.Street.Text }} {{ main_address.Address.Town.Text }} ({{ main_address.Address.ProvinceState.Text }})/" target="_blank">{{ "Get directions" | t }}</a>
								</p>
								<a class="btn btn-primary" href="{{ machinery_advertiser | display_url }}">Contactez l'annonceur</a>
							</div>
					</div>
				
				</div>
				{% endif %}
		</div>
		<div class="col-md-6 text-right">
		    {% if machinery_advertiser.Content.Advertiser.Logo.Paths[0] != null %}
			<div class="row mb-4">
				<div class="col">
					<img class="img-fluid" src="{{ machinery_advertiser.Content.Advertiser.Logo.Paths[0] | asset_url }}" alt="logo" /><br/>
				</div>
			</div>
			{% endif %}
			<div class="row">
				<div class="col">
					<a class="btn btn-primary" href="{{ machinery_advertiser | display_url }}">Voir toutes les annonces</a>
				</div>
			</div>
		</div>
	</div>
	{% assign addresses = machinery_advertiser.Content.Address.ContentItems %}
	{% assign count = addresses.size - 1 %}
	{% if count >= 1 %}
	<div class="row">
        <div class="col">
			<h3>Autres points de service</h3>
			<div class="row mb-3">
				{% for i in (1..count) %}
					<div class="col-md-6">
						<p>
							<strong>{{ addresses[i].Address.Town.Text }}</strong><br/>
							{{ addresses[i].Address.Street.Text }}<br/>
							{{ addresses[i].Address.Town.Text }}
							{{ addresses[i].Address.ProvinceState.Text }}
							{{ addresses[i].Address.PostalCode.Text }}<br/>
							<a href="https://www.google.com/maps/dir/{{ addresses[i].Address.PostalCode.Text }}/{{ addresses[i].Address.Street.Text }} {{ addresses[i].Address.Town.Text }} ({{ addresses[i].Address.ProvinceState.Text }})/" target="_blank">{{ "Get directions" | t }}</a>
						</p>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
	{% endif %}
  </div>
  {% endif %}

  {% assign relatedService = Queries.RelatedService |  query: from: 0, size: 3, condition: "*", type: machinery_type.ContentItemId, brand: machinery_brand.ContentItemId, current: Model.ContentItem.ContentItemId %}
  {% assign count = relatedService | size %}
  {% if count > 0 %}
  <hr class="mt-4" />
  
  
  <h2 class="text-center mt-4 mb-4">Annonces similaires</h2>
  <div class="row">  
  
  {% for item in relatedService %}
          <div class="col-md-4 d-flex align-items-stretch">

            {% assign machinery_type = Content.ContentItemId[item.Content.Service.Type.ContentItemIds[0]] %}
            {% assign machinery_brand = Content.ContentItemId[item.Content.Service.Brand.ContentItemIds[0]] %}
            {% assign machinery_advertiser = Content.ContentItemId[item.Content.Service.Advertiser.ContentItemIds[0]] %}
            {% assign machinery_region = Content.ContentItemId[item.Content.Service.Region.ContentItemIds[0]] %}
            {% assign img_alt =  machinery_type | append: ' ' | machinery_brand | append: ' ' | append: item.Content.Service.Model.Text %}
            <div class="card mb-3">
                <a href="{{ item | display_url }}">
                    {% if item.Content.Service.WebsitePictures.Paths.size > 0 %}
                        {{ item.Content.Service.WebsitePictures.Paths[0] | asset_url | resize_url: 480 | img_tag: alt: img_alt, class:'card-img-top' }}
                    {% else %}
                        <img class="card-img-top" alt="no image" src="/AffairesExtra/img/noimage.png">
                    {% endif %}
                </a>
              <div class="card-body">
                {% if item.Content.Service.Price.Value > 0 %}
                  <h5 class="card-text">{{ item.Content.Service.Price.Value }} $ CAD</h5>
                {% else %}
                  <h5 class="card-text">{{ "Price upon request" | t }}</h5>
                {% endif %}    
                <h5 class="card-title"><a href="{{ item | display_url }}">{{ machinery_type | display_text }} <br/> {{ machinery_brand | display_text }} {{ item.Content.Service.Model.Text }}</a></h5> 
                {% if item.Content.Service.Year.Value != null and item.Content.Service.Year.Value > 0 %}
                <p class="card-text">Année: {{ item.Content.Service.Year.Value }}</p>
                {% endif %}
                {% if machinery_advertiser %}
                <p class="card-text">Concessionnaire: {{ machinery_advertiser | display_text }}</p>
                {% endif %}
                {% if machinery_region %}
                <p class="card-text">Région: {{ machinery_region }}</p>
                {% endif %}

              </div>
              <div class="card-footer text-center"><a href="{{ item | display_url }}" class="btn btn-primary align-self-center">Voir la fiche</a></div>
            </div>
          </div>
  {% endfor %}
  </div>
  {% endif %}
</section>